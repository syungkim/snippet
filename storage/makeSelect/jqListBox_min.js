/****************
 * jqListBox
 * jQuery Custom SelectBox
 * syung2nara@gmail.com
 * update : 2014/01/24
 * version : 1.00
 *****************/
!function(t){"use strict";var i=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?!0:!1};t.fn.jqListBox=function(){return this.each(function(o){var s=t(this),e=s.find("option").length,n=[],a=[],c=[],l=20-o,d=s.find("option:selected").index(),r=s.data("class")?" "+s.data("class"):"",f=s.attr("id")?s.attr("id"):"",h=s.data("width")?s.data("width"):s.width();t.each(s.find("option"),function(){var i=t(this);n.push(i.text()),c.push(i.val()),a.push(i.attr("title")?i.attr("title"):i.text())});var x={el:function(){var t=s.next(".jqListBox"),i=t.find(".jqListBox-combo > a "),o=i.find(".jqListBox-combo-txt"),e=i.find(".jqListBox-combo-arrow"),n=t.find(".jqListBox-list"),a=n.find(".jqListBox-option");return{listbox:t,combo:i,comboTxt:o,comboArr:e,list:n,option:a}},init:function(){var t=this;t.makeHTML(),t.setListBoxWidth(),t.bindEvent(),t.changeOption(d)},makeHTML:function(){var t="";t+='<span class="jqListBox'+r+'"data-origin="'+f+'" style="z-index:'+l+'">',t+='<span class="jqListBox-combo"><a href="#" data-id="0"><span class="jqListBox-combo-txt">'+n[0]+'</span><span class="jqListBox-combo-arrow"></span></a></span>',t+=s.data("maxheight")?'<ul class="jqListBox-list" role="listbox" style="display:none;max-height:'+s.data("maxheight")+'px">':'<ul class="jqListBox-list" role="listbox" style="display:none">';for(var i=0;e>i;i++){var o=void 0!=a[i]?"title="+a[i]:"";t+=0!=i?'<li class="jqListBox-option" data-id="'+i+'" data-val="'+c[i]+'" role="option"><a href="#" '+o+">"+n[i]+"</a></li>":'<li class="jqListBox-option selected" data-id="'+i+'" data-val="'+c[i]+'" role="option"><a href="#" '+o+">"+n[i]+"</a></li>"}t+="</ul>",t+="</span>",s.hide().after(t)},setListBoxWidth:function(){var t=this.el(),i=h-t.comboArr.outerWidth();t.comboTxt.width(i),t.list.width(t.combo.width())},changeOption:function(t){var i=this.el();i.option.removeClass("selected").eq(t).addClass("selected"),i.combo.attr("data-id",t).find(".jqListBox-combo-txt").text(n[t]),s.find("option:eq("+t+")").prop("selected",!0).end().change()},openList:function(){var t=this.el();t.combo.find(".jqListBox-combo-arrow").addClass("on"),t.list.slideDown(100,function(){t.list.find(".selected > a").focus()})},closeList:function(){var t=this.el();t.combo.find(".jqListBox-combo-arrow").removeClass("on"),t.list.slideUp(100)},bindEvent:function(){var i=this,o=this.el();o.combo.on({click:function(t){o.list.is(":visible")?i.closeList():i.openList(),t.preventDefault()},keydown:function(t){(38==t.keyCode||40==t.keyCode)&&i.openList(),9==t.keyCode&&t.shiftKey&&i.closeList()}}),o.option.find(">a").on({click:function(s){var e=t(this).closest("li").data("id");i.changeOption(e),i.closeList(),o.combo.focus(),s.preventDefault()},keydown:function(s){var e=t(this).closest("li"),n=e.index();38==s.keyCode&&(0!=n&&n--,o.option.eq(n).find(">a").focus()),40==s.keyCode&&(n++,o.option.eq(n).find(">a").focus()),27==s.keyCode&&(i.closeList(),o.combo.focus())}}),o.option.last().find(">a").on({keydown:function(t){9==t.keyCode&&(t.shiftKey||i.closeList())}}),o.listbox.on("mouseleave",function(){i.closeList()})}};s.is("select")&&x.init(),i()&&(s.css({position:"absolute",width:h,display:"block",opacity:0}).next(".jqListBox").css("z-index","-1"),s.change(function(){x.changeOption(s.find("option:selected").index())}))})},t.fn.refresh=function(){return t(this).is("select")?this.each(function(){t(this).next(".jqListBox").length&&t(this).next(".jqListBox").remove(),t(this).jqListBox()}):void 0}}(jQuery);