/****************
 * jqListBox
 * jQuery Custom SelectBox
 * iam@syung.kr
 * update : 2014/02/13
 * version : 1.02
 *****************/
!function(t){"use strict";var e=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?!0:!1};t.fn.jqListBox=function(){return this.each(function(i){var o=t(this),s=o.find("option").length,a=[],n=[],c=[],l=20-i,r=o.find("option:selected").index(),d=o.data("class")?" "+o.data("class"):"",p=o.attr("id")?'data-origin="'+o.attr("id")+'"':"",f=o.attr("title")?'title="'+o.attr("title")+'"':"",u=o.data("width")?o.data("width"):o.width(),h=o.data("maxheight")?"max-height:"+o.data("maxheight")+"px;":"";t.each(o.find("option"),function(){var e=t(this);a.push(e.text()),c.push(e.val()),n.push(e.attr("title")?e.attr("title"):e.text())});var x={el:function(){var t=o.next(".jqListBox"),e=t.find(".jqListBox-combo"),i=e.find(".jqListBox-combo-txt"),s=e.find(".jqListBox-combo-arrow"),a=t.find(".jqListBox-list"),n=a.find(".jqListBox-option");return{listbox:t,combo:e,comboTxt:i,comboArr:s,list:a,option:n}},init:function(){var t=this;t.makeHTML(),t.setListBoxWidth(),t.bindEvent(),t.changeOption(r)},makeHTML:function(){var t="";t+='<span class="jqListBox'+d+'"'+p+'style="z-index:'+l+'" '+f+">",t+='<span class="jqListBox-combo" id="jqListBox-combo-'+i+'" tabindex="0" role="combobox" aria-autocomplete="list" aria-haspopup="true" aria-owns="jqListBox-list-'+i+'"><span class="jqListBox-combo-txt" data-id="0">'+a[0]+'</span><span class="jqListBox-combo-arrow"></span></span>',t+='<ul class="jqListBox-list" id="jqListBox-list-'+i+'"role="listbox" aria-hidden="false" role="listbox" aria-labelledby="jqListBox-combo-'+i+'" style="display:none;'+h+'">';for(var e=0;s>e;e++)t+=0!=e?'<li class="jqListBox-option" data-id="'+e+'" data-val="'+c[e]+'"role="option" tabindex="0">'+a[e]+"</li>":'<li class="jqListBox-option selected" data-id="'+e+'" data-val="'+c[e]+'" role="option" tabindex="0">'+a[e]+"</li>";t+="</ul>",t+="</span>",o.hide().after(t)},setListBoxWidth:function(){var t=this.el(),e=u-t.comboArr.outerWidth();t.comboTxt.width(e),t.list.width(t.combo.width())},changeOption:function(t){var e=this.el();e.option.removeClass("selected").eq(t).addClass("selected"),e.combo.find(".jqListBox-combo-txt").attr("data-id",t).text(a[t]),o.find("option:eq("+t+")").prop("selected",!0).end().change()},openList:function(){var t=this.el();t.combo.find(".jqListBox-combo-arrow").addClass("on"),t.list.slideDown(100,function(){t.list.find(".selected").focus()})},closeList:function(){var t=this.el();t.combo.focus().find(".jqListBox-combo-arrow").removeClass("on"),t.list.slideUp(100)},bindEvent:function(){var e=this,i=this.el(),o=i.option.length;i.combo.on({click:function(t){i.list.is(":visible")?e.closeList():e.openList(),t.preventDefault()},keydown:function(t){var a=i.option.filter(".selected").index();if(t.altKey){if(t.altKey)switch(t.keyCode){case 38:case 40:e.openList()}}else switch(t.keyCode){case 13:t.preventDefault();break;case 27:e.closeList();break;case 32:e.openList();break;case 33:a>=3?i.option.eq(a-3).click():i.option.eq(0).click(),t.preventDefault();break;case 34:s>=a+3?i.option.eq(a+3).click():i.option.eq(s-1).click(),t.preventDefault();break;case 35:i.option.eq(-1).click(),t.preventDefault();break;case 36:i.option.eq(0).click(),t.preventDefault();break;case 37:case 38:a>0&&i.option.eq(a-1).click(),t.preventDefault();break;case 39:case 40:o>a&&i.option.eq(a+1).click(),t.preventDefault()}}}),i.option.on({click:function(o){var s=t(this).closest("li").data("id");e.changeOption(s),e.closeList(),i.combo.focus(),o.preventDefault()},keydown:function(o){var a=t(this).closest("li"),n=a.index();if(o.altKey){if(o.altKey)switch(o.keyCode){case 38:case 40:e.closeList()}}else switch(o.keyCode){case 13:case 32:t(this).click(),o.preventDefault();break;case 27:e.closeList(),i.combo.focus();break;case 33:n>=3?i.option.eq(n-3).focus():i.option.eq(0).focus(),o.preventDefault();break;case 34:s>=n+3?i.option.eq(n+3).focus():i.option.eq(s-1).focus(),o.preventDefault();break;case 35:i.option.eq(-1).focus(),o.preventDefault();break;case 36:i.option.eq(0).focus(),o.preventDefault();break;case 37:case 38:0!=n&&n--,i.option.eq(n).focus(),o.preventDefault();break;case 39:case 40:n++,i.option.eq(n).focus(),o.preventDefault()}}}),i.option.last().find(">a").on({keydown:function(t){9==t.keyCode&&(t.shiftKey||e.closeList())}}),i.listbox.on("mouseleave",function(){e.closeList()})}};o.is("select")&&x.init(),e()&&(o.css({position:"absolute",width:u,display:"block",opacity:0}).next(".jqListBox").css("z-index","-1"),o.change(function(){x.changeOption(o.find("option:selected").index())}))})},t.fn.refresh=function(){return t(this).is("select")?this.each(function(){t(this).next(".jqListBox").length&&t(this).next(".jqListBox").remove(),t(this).jqListBox()}):void 0}}(jQuery);